plugins{
    id 'java'
    id 'org.springframework.boot' version '2.1.4.RELEASE'
    // TODO: add id 'checkstyle'
    id 'com.github.spotbugs'
    id 'io.spring.dependency-management'
}

group = 'com.transferwise.tasks'

sourceCompatibility = '1.8'
targetCompatibility = '1.8'

compileJava {
    options.encoding = 'utf-8'
    options.compilerArgs << '-parameters'
}

repositories {
    mavenCentral()
    maven { 
       url 'https://arti.tw.ee/artifactory/libs-release'
    }
    mavenLocal()
}

dependencyManagement {
    imports {
        mavenBom "org.springframework.boot:spring-boot-dependencies:2.1.5.RELEASE"
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:Greenwich.SR1"
    }
}

dependencies {
    annotationProcessor 'org.projectlombok:lombok'

    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-jdbc'
    implementation 'org.springframework.kafka:spring-kafka'
    implementation 'org.projectlombok:lombok'
    implementation 'com.transferwise.common:tw-gaffer-jta:1.3.1'
    implementation 'org.apache.tomcat:tomcat-jdbc'
    implementation 'com.transferwise.tasks:tw-tasks-executor:1.0.3'
    implementation 'com.transferwise.common:tw-base-utils:1.2.3'
    implementation 'com.transferwise.common:tw-graceful-shutdown:1.2.2'
    implementation 'com.transferwise.common:tw-graceful-shutdown-interfaces:1.3.2'
    implementation 'org.apache.curator:curator-recipes:4.2.0'

    runtimeOnly 'org.springframework.boot:spring-boot-starter-actuator'
    runtimeOnly('org.springframework.boot:spring-boot-starter-aop') // TODO: Get rid of that by autowiring interface everywhere. It is a bad example to copy.
    runtimeOnly 'io.micrometer:micrometer-registry-prometheus'
    runtimeOnly 'mysql:mysql-connector-java'
    runtimeOnly 'org.codehaus.janino:janino'
    runtimeOnly 'org.liquibase:liquibase-core'
    runtimeOnly 'org.postgresql:postgresql'
}


spotbugs{
    sourceSets = [sourceSets.main]
    effort = "max"
}

tasks.withType(com.github.spotbugs.SpotBugsTask) {
    reports {
        xml.enabled false
        html.enabled true
    }
}

springBoot {
    mainClassName = 'com.transferwise.tasks.demoapp.Application'
}

bootRun {
    systemProperties = System.properties
}

bootJar {
    excludeDevtools = true
}
